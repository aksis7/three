<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузка GLB модели в Three.js 0.178.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .content {
            display: flex;
            flex: 1;
            gap: 20px;
        }
        
        #canvas-container {
            flex: 3;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            background: rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .controls {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-group {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }
        
        h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #ffcc00;
            text-align: center;
        }
        
        .control-item {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #ffcc00;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(to right, #ff8c00, #ffcc00);
            color: #1a1a1a;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }
        
        .status {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 15px;
            margin-top: auto;
        }
        
        .status h2 {
            margin-bottom: 10px;
        }
        
        #progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        #progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #00c9ff, #92fe9d);
            transition: width 0.3s ease;
        }
        
        #status-text {
            text-align: center;
            font-size: 0.9rem;
            color: #ccc;
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10;
            flex-direction: column;
            gap: 20px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid #ffcc00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2rem;
            text-align: center;
        }
        
        .model-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #ccc;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        @media (max-width: 900px) {
            .content {
                flex-direction: column;
            }
            
            #canvas-container {
                min-height: 60vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Загрузка GLB модели в Three.js 0.178.0</h1>
            <p class="subtitle">Демонстрация загрузки 3D-модели в формате GLB с использованием Three.js версии 0.178.0. Вращайте модель с помощью мыши, используйте элементы управления для изменения освещения и внешнего вида модели.</p>
        </header>
        
        <div class="content">
            <div id="canvas-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Загрузка Three.js и модели...</div>
                </div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <h2>Управление моделью</h2>
                    <div class="control-item">
                        <label for="rotation-speed">Скорость вращения: <span id="rotation-value">0.5</span></label>
                        <input type="range" id="rotation-speed" min="0" max="1" step="0.01" value="0.5">
                    </div>
                    <div class="control-item">
                        <label for="model-scale">Масштаб модели: <span id="scale-value">1.0</span></label>
                        <input type="range" id="model-scale" min="0.1" max="2" step="0.1" value="1">
                    </div>
                    <div class="button-group">
                        <button id="reset-position">Сбросить позицию</button>
                        <button id="toggle-rotation">Включить вращение</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h2>Освещение</h2>
                    <div class="control-item">
                        <label for="ambient-light">Окружающий свет: <span id="ambient-value">0.5</span></label>
                        <input type="range" id="ambient-light" min="0" max="1" step="0.01" value="0.5">
                    </div>
                    <div class="control-item">
                        <label for="directional-light">Направленный свет: <span id="directional-value">1.0</span></label>
                        <input type="range" id="directional-light" min="0" max="1" step="0.01" value="1.0">
                    </div>
                    <div class="button-group">
                        <button id="light-color1">Жёлтый свет</button>
                        <button id="light-color2">Голубой свет</button>
                    </div>
                </div>
                
                <div class="status">
                    <h2>Состояние загрузки</h2>
                    <div id="progress-bar">
                        <div id="progress"></div>
                    </div>
                    <div id="status-text">Ожидание загрузки скриптов...</div>
                    <div class="model-info">
                        <span>Формат: GLB</span>
                        <span>Версия Three.js: 0.178.0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            Three.js GLB Loader Demo | Для вращения модели используйте мышь | Для масштабирования используйте колесо мыши
        </footer>
    </div>

    <!-- Подключаем Three.js и GLTFLoader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.min.js"></script>
    <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
        // Основные переменные
        let scene, camera, renderer, model;
        let ambientLight, directionalLight;
        let loader, controls;
        let rotateModel = true;
        let rotationSpeed = 0.5;
        
        // Элементы интерфейса
        const loadingOverlay = document.querySelector('.loading');
        const progressBar = document.getElementById('progress');
        const statusText = document.getElementById('status-text');
        const rotationValue = document.getElementById('rotation-value');
        const scaleValue = document.getElementById('scale-value');
        const ambientValue = document.getElementById('ambient-value');
        const directionalValue = document.getElementById('directional-value');
        
        // Инициализация Three.js
        function init() {
            // Обновляем статус
            updateStatus('Создание сцены...');
            
            // Создаем сцену
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            scene.fog = new THREE.Fog(0x1a1a2e, 10, 20);
            
            // Создаем камеру
            camera = new THREE.PerspectiveCamera(
                75, 
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 0, 5);
            
            // Создаем рендерер
            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                alpha: true
            });
            renderer.setSize(document.getElementById('canvas-container').offsetWidth, 
                            document.getElementById('canvas-container').offsetHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Добавляем освещение
            addLights();
            
            // Добавляем элементы окружения
            addEnvironment();
            
            // Инициализируем загрузчик
            loader = new THREE.GLTFLoader();
            
            // Загружаем модель
            loadModel();
            
            // Обработчики событий
            setupEventListeners();
            
            // Запускаем анимацию
            animate();
        }
        
        // Добавляем освещение
        function addLights() {
            // Окружающий свет
            ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            // Направленный свет
            directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(2, 3, 4);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Вспомогательный свет
            const lightHelper = new THREE.DirectionalLightHelper(directionalLight, 1);
            scene.add(lightHelper);
        }
        
        // Добавляем окружение
        function addEnvironment() {
            // Пол (плоскость)
            const planeGeometry = new THREE.PlaneGeometry(20, 20);
            const planeMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x0a3d62,
                roughness: 0.8,
                metalness: 0.2
            });
            const plane = new THREE.Mesh(planeGeometry, planeMaterial);
            plane.rotation.x = -Math.PI / 2;
            plane.position.y = -2;
            plane.receiveShadow = true;
            scene.add(plane);
            
            // Сетка для пола
            const gridHelper = new THREE.GridHelper(20, 20, 0xffffff, 0xffffff);
            gridHelper.position.y = -2;
            scene.add(gridHelper);
        }
        
        // Загружаем модель
        function loadModel() {
            updateStatus('Начало загрузки модели...');
            
            // URL модели (встроенная модель Duck.glb)
            const modelUrl = 'model.glb';
            
            loader.load(
                modelUrl,
                (gltf) => {
                    // Успешная загрузка
                    model = gltf.scene;
                    
                    // Настройка модели
                    model.position.set(0, -1, 0);
                    model.scale.set(0.01, 0.01, 0.01);
                    model.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                        }
                    });
                    
                    scene.add(model);
                    
                    updateStatus('Модель успешно загружена!');
                    progressBar.style.width = '100%';
                    
                    // Скрываем прелоадер
                    setTimeout(() => {
                        loadingOverlay.style.opacity = '0';
                        setTimeout(() => {
                            loadingOverlay.style.display = 'none';
                        }, 500);
                    }, 1000);
                },
                (xhr) => {
                    // Прогресс загрузки
                    const percent = (xhr.loaded / xhr.total) * 100;
                    progressBar.style.width = `${percent}%`;
                    updateStatus(`Загрузка модели: ${Math.round(percent)}%`);
                },
                (error) => {
                    // Ошибка загрузки
                    console.error('Ошибка загрузки модели', error);
                    updateStatus('Ошибка загрузки модели. Проверьте консоль для подробностей.');
                    progressBar.style.background = '#ff4757';
                }
            );
        }
        
        // Обновление статуса
        function updateStatus(message) {
            statusText.textContent = message;
        }
        
        // Настройка обработчиков событий
        function setupEventListeners() {
            // Обработка изменения размера окна
            window.addEventListener('resize', onWindowResize);
            
            // Элементы управления
            document.getElementById('rotation-speed').addEventListener('input', (e) => {
                rotationSpeed = parseFloat(e.target.value);
                rotationValue.textContent = rotationSpeed.toFixed(2);
            });
            
            document.getElementById('model-scale').addEventListener('input', (e) => {
                if (model) {
                    const scale = parseFloat(e.target.value);
                    model.scale.set(scale, scale, scale);
                    scaleValue.textContent = scale.toFixed(1);
                }
            });
            
            document.getElementById('ambient-light').addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                ambientLight.intensity = value;
                ambientValue.textContent = value.toFixed(2);
            });
            
            document.getElementById('directional-light').addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                directionalLight.intensity = value;
                directionalValue.textContent = value.toFixed(2);
            });
            
            document.getElementById('reset-position').addEventListener('click', () => {
                if (model) {
                    model.rotation.set(0, 0, 0);
                }
            });
            
            document.getElementById('toggle-rotation').addEventListener('click', (e) => {
                rotateModel = !rotateModel;
                e.target.textContent = rotateModel ? 'Выключить вращение' : 'Включить вращение';
            });
            
            document.getElementById('light-color1').addEventListener('click', () => {
                directionalLight.color.set(0xffff00);
            });
            
            document.getElementById('light-color2').addEventListener('click', () => {
                directionalLight.color.set(0x00ffff);
            });
            
            // Вращение модели мышью
            let isDragging = false;
            let previousMousePosition = {
                x: 0,
                y: 0
            };
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
            });
            
            window.addEventListener('mousemove', (e) => {
                if (!isDragging || !model) return;
                
                const deltaMove = {
                    x: e.clientX - previousMousePosition.x,
                    y: e.clientY - previousMousePosition.y
                };
                
                model.rotation.y += deltaMove.x * 0.01;
                model.rotation.x += deltaMove.y * 0.01;
                
                previousMousePosition = {
                    x: e.clientX,
                    y: e.clientY
                };
            });
            
            window.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            // Масштабирование колесом мыши
            renderer.domElement.addEventListener('wheel', (e) => {
                if (!model) return;
                
                e.preventDefault();
                const scale = model.scale.x + (e.deltaY * -0.001);
                model.scale.set(
                    Math.min(Math.max(0.5, scale), 2.0),
                    Math.min(Math.max(0.5, scale), 2.0),
                    Math.min(Math.max(0.5, scale), 2.0)
                );
                
                document.getElementById('model-scale').value = scale;
                scaleValue.textContent = scale.toFixed(1);
            });
        }
        
        // Обработка изменения размера окна
        function onWindowResize() {
            camera.aspect = document.getElementById('canvas-container').offsetWidth / 
                            document.getElementById('canvas-container').offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(
                document.getElementById('canvas-container').offsetWidth, 
                document.getElementById('canvas-container').offsetHeight
            );
        }
        
        // Анимация
        function animate() {
            requestAnimationFrame(animate);
            
            // Вращение модели
            if (model && rotateModel) {
                model.rotation.y += 0.005 * rotationSpeed;
            }
            
            // Плавное движение камеры
            const time = Date.now() * 0.0005;
            camera.position.x = Math.sin(time * 0.2) * 3;
            camera.position.z = Math.cos(time * 0.2) * 3;
            camera.lookAt(scene.position);
            
            renderer.render(scene, camera);
        }
        
        // Запуск приложения после загрузки скриптов
        window.onload = init;
    </script>
</body>
</html>